!function(n){var i={};function o(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=n,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,OO.EventEmitter),i(s,[{key:"change",value:function(){this.emit("change")}},{key:"UI",value:function(){return mw.log.error("UI not defined by extending class "+this.type+"Option.")}},{key:"buildUI",value:function(e){if(!this.hide)return this.UI(this[e])}},{key:"get UIvalue",value:function(){return mw.log.error("get UIvalue not defined by extending class "+this.type+"Option.")}},{key:"getCustomUIValue",value:function(){var e=void 0;if((e=this.UIelement?this.get UIvalue():this.value)!==this.defaultValue)return e}},{key:"value",get:function(){return void 0!==this.customValue?this.customValue:this.defaultValue}}]),s);function s(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));if(t.name=e.name,t.defaultValue=e.defaultValue,t.type=e.type,t.UIconfig=e.UIconfig||{},t.label=e.label,t.help=e.help,t.hide=e.hide,t.UIconfig.classes=["libSettings-"+t.type+"Option"],t.validInput=!0,void 0===t.name||void 0===t.defaultValue){var n=void 0===t.name?"name":"defaultValue";throw Error('[libSettings] "'+n+'" of an Option is required to be defined but is not.')}if(void 0===t.type)throw Error('[libSettings] "config.type" is required to be defined by classes that extend Option.');return t}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r,s=n(0);var a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,((r=s)&&r.__esModule?r:{default:r}).default),i(u,[{key:"validate",value:function(){var e=this;return this.UIelement.getValidity().then(function(){e.validInput=!0},function(){e.validInput=!1})}},{key:"UI",value:function(e){var t=this;return this.UIconfig.name=this.name,this.UIconfig.value=e,this.UIelement=new OO.ui[this.widget](this.UIconfig),this.UIelement.connect(this,{change:function(){t.validate().then(function(){return t.change()})}}),this.validate(),new OO.ui.FieldLayout(this.UIelement,{text:this.label,help:this.help,helpInline:this.helpInline,align:"top"})}},{key:"get UIvalue",value:function(){return this.UIelement.getValue()}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),e.type=e.type||"Text";var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e));return t.widget="TextInputWidget",t}t.default=a},function(e,t,n){"use strict";var i=c(n(0)),o=c(n(3)),r=c(n(6)),s=c(n(7)),a=c(n(1)),u=c(n(8)),l=c(n(9));function c(e){return e&&e.__esModule?e:{default:e}}mw.util.addCSS(".libSettings-NumberOption {\n\tmax-width: 15em\n}"),mw.libs.libSettings={},mw.libs.libSettings.Option=i.default,mw.libs.libSettings.Settings=o.default,mw.libs.libSettings.CheckboxOption=r.default,mw.libs.libSettings.DateOption=s.default,mw.libs.libSettings.TextOption=a.default,mw.libs.libSettings.NumberOption=u.default,mw.libs.libSettings.DropdownOption=l.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r,s=n(4),a=(r=s)&&r.__esModule?r:{default:r};var u=n(5),l=(i(c,[{key:"runOverOptionsConfig",value:function(t){this.optionsConfig.forEach(function(e){e.preferences.forEach(function(e){e.header?e.options.forEach(function(e){return t(e)}):t(e)})})}},{key:"load",value:function(){this.optionsText=mw.user.options.get(this.optionName),this.userOptions=JSON.parse(this.optionsText)||{}}},{key:"transfer",value:function(){var n=this;return this.runOverOptionsConfig(function(e){var t=n.userOptions[e.name];void 0!==t&&(e.customValue=t)}),this.options={},this.runOverOptionsConfig(function(e){n.options[e.name]=e.value}),this.options}},{key:"get",value:function(){return this.options||(this.saveSettings&&this.load(),this.transfer()),this.options}},{key:"notifySave",value:function(e){this.notifyUponSave&&(e?mw.notify(this.saveMessage):mw.notify(this.saveFailMessage))}},{key:"save",value:function(){var t=this;return this.newUserOptions={},this.runOverOptionsConfig(function(e){t.newUserOptions[e.name]=e.getCustomUIValue()}),this.saveSettings?mw.loader.using("mediawiki.api").then(function(){return t.API=new mw.Api({ajax:{headers:{"Api-User-Agent":"Script "+t.scriptName+" using libSettings."}}}),t.API.saveOption(t.optionName,JSON.stringify(t.newUserOptions)).then(function(){return t.notifySave(!0)},function(){return t.notifySave(!1)})}):(this.notifySave(!0),function(){return t.newUserOptions})}},{key:"displayMain",value:function(){var i=this;if(!this.windowManager){var e=(0,a.default)();e.static.name="settingsDialog",e.static.title=this.title,e.static.actions=[{action:"save",label:this.saveSettingsLabel,flags:["primary","progressive"]},{label:this.cancelLabel,flags:["safe","destructive"]},{action:"showDefault",label:this.showDefaultsLabel}],0<Object.keys(this.userOptions).length&&e.static.actions.push({action:"showCurrentSettings",label:this.showCurrentSettingsLabel}),this.settingsDialog=new e({size:this.size,classes:["settingsDialog"]},this),this.runOverOptionsConfig(function(e){e.connect(i.settingsDialog,{change:"changeHandler"})}),this.windowManager=new OO.ui.WindowManager,document.body.appendChild(this.windowManager.$element[0]),this.windowManager.addWindows([this.settingsDialog]),this.windowManager.on("closing",function(e,t,n){n&&n.then(function(){i.reloadUponSave&&window.location.reload()})})}return this.windowManager.openWindow(this.settingsDialog),this.windowManager}},{key:"display",value:function(){var e=this;return this.get(),mw.loader.using(["oojs-ui-core","oojs-ui-widgets","oojs-ui-windows"]).then(function(){return e.displayMain()})}}]),c);function c(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),mw.messages.set(u),this.optionsConfig=t.optionsConfig,this.scriptName=t.scriptName,this.optionName="userjs-"+(t.optionName||t.scriptName),this.size=t.size,this.title=t.title||mw.msg("libSettings-settings-title"),this.saveSettings=void 0===t.saveSettings||t.saveSettings,this.notifyUponSave=void 0!==t.notifyUponSave?t.notifyUponSave:this.saveSettings,this.reloadUponSave=void 0!==t.reloadUponSave?t.reloadUponSave:this.saveSettings,this.userOptions=t.userOptions||{},this.runOverOptionsConfig(function(e){void 0===e.helpInline&&(e.helpInline=t.helpInline)}),this.height=t.height,this.saveSettingsLabel=t.saveSettingsLabel||mw.msg("libSettings-save-label"),this.cancelLabel=t.cancelLabel||mw.msg("libSettings-cancel-label"),this.showDefaultsLabel=t.showDefaultsLabel||mw.msg("libSettings-showDefaults-label"),this.showCurrentSettingsLabel=t.showCurrentSettingsLabel||mw.msg("libSettings-showCurrentSettings-label"),this.saveMessage=mw.msg("libSettings-save-success-message",this.scriptName),this.saveFailMessage=mw.msg("libSettings-save-fail-message",this.scriptName)}t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:a(o,t,n)}if("value"in i)return i.value;var r=i.get;return void 0!==r?r.call(n):void 0}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.default=function(){var s=function(e){function s(e,t,n,i,o){u(this,s);var r=l(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e,t));return r.element=n,r.element.preferences.forEach(function(e){if(!o(e))if(e.header){e.UIconfig=e.UIconfig||{},e.UIconfig.label=e.header;var t=new OO.ui.FieldsetLayout(e.UIconfig),n=e.options.map(function(e){return e.buildUI(i)});n=n.filter(function(e){return e}),t.addItems(n),r.$element.append(t.$element)}else r.$element.append(e.buildUI(i).$element)}),r}return c(s,e),r(s,[{key:"setupOutlineItem",value:function(){this.outlineItem.setLabel(this.element.title),this.outlineItem.setLevel(this.element.level)}}]),s}(OO.ui.PageLayout);return function(e){function i(e,t){u(this,i);var n=l(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return n.settings=t,n}return c(i,e),r(i,[{key:"hideHandle",value:function(e){switch(o(e.hide)){case"boolean":return e.hide;case"function":return e.hide()}}},{key:"genInternalUI",value:function(t){var n=this,e=this.settings.optionsConfig.filter(function(e){return!n.hideHandle(e)}),i=1===e.length,o=void 0,r=e.map(function(e){return new s(e.title,{padded:i,scrollabe:!1},e,t,n.hideHandle)});return i?o=r[0]:(o=new OO.ui.BookletLayout({outlined:!0})).addPages(r),this.outerHeight=r[0].$element.outerHeight(!0),o}},{key:"setupUI",value:function(e){this.content=this.genInternalUI(e),this.$body.html(this.content.$element),this.changeHandler()}},{key:"getSetupProcess",value:function(){var e=this,t=a(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"getSetupProcess",this).call(this);return t.next(function(){return e.setupUI("value")}),t}},{key:"changeHandler",value:function(){var n=!0,i=!1,o=!1;this.settings.runOverOptionsConfig(function(e){if(e.UIelement){e.validInput||(n=!1);var t=e.get UIvalue();t!==e.value&&(i=!0),t!==e.defaultValue&&(o=!0)}}),this.actions.setAbilities({save:n&&i,showDefault:o,showCurrentSettings:i})}},{key:"regenUI",value:function(e){var t=void 0;this.content.getCurrentPageName&&(t=this.content.getCurrentPageName()),this.setupUI(e),t&&this.content.setPage(t)}},{key:"getActionProcess",value:function(e){var t=this;return"save"===e?new OO.ui.Process(function(){var e=t.settings.save();t.pushPending(),t.close(e)}):"showDefault"===e?new OO.ui.Process(function(){t.regenUI("defaultValue")}):"showCurrentSettings"===e?new OO.ui.Process(function(){t.regenUI("value")}):a(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"getActionProcess",this).call(this,e)}},{key:"getHoldProcess",value:function(e){var t=this,n=a(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"getHoldProcess",this).call(this,e);return e&&(n.next(e),n.next(function(){return t.popPending()})),n}},{key:"getBodyHeight",value:function(){return this.settings.height||1*this.content.$element.outerWidth(!0)/1.61803398875}}]),i}(OO.ui.ProcessDialog)}},function(e){e.exports={"@metadata":{author:"Galobtter"},"libSettings-settings-title":"Settings","libSettings-save-label":"Save settings","libSettings-cancel-label":"Cancel","libSettings-showDefaults-label":"Show defaults","libSettings-showCurrentSettings-label":"Show current settings","libSettings-save-success-message":"Settings for $1 successfully saved.","libSettings-save-fail-message":"Could not save settings for $1."}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r,s=n(0);var a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,((r=s)&&r.__esModule?r:{default:r}).default),i(u,[{key:"UI",value:function(e){return this.UIconfig.name=this.name,this.UIconfig.selected=e,this.UIelement=new OO.ui.CheckboxInputWidget(this.UIconfig),this.UIelement.connect(this,{change:"change"}),new OO.ui.FieldLayout(this.UIelement,{help:this.help,label:this.label,helpInline:this.helpInline,align:"inline"})}},{key:"get UIvalue",value:function(){return this.UIelement.isSelected()}}]),u);function u(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),e.type="Checkbox",function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e))}t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(0);var r=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,((i=o)&&i.__esModule?i:{default:i}).default),s);function s(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),e.type="Date",function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e))}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r,s=n(1);var a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,((r=s)&&r.__esModule?r:{default:r}).default),i(u,[{key:"get UIvalue",value:function(){return Number(function e(t,n,i){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,i)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(i):void 0}(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"get UIvalue",this).call(this))}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),e.type="Number";var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e));return t.widget="NumberInputWidget",t}t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r,s=n(0);var a=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,((r=s)&&r.__esModule?r:{default:r}).default),i(u,[{key:"UI",value:function(n){var i=this;return this.UIconfig.name=this.name,this.UIconfig.options=this.values,this.UIconfig.options.some(function(e,t){if(e.data===n)return i.UIconfig.options.unshift(i.UIconfig.options.splice(t,1)[0]),!0}),this.UIelement=new OO.ui.DropdownInputWidget(this.UIconfig),this.UIelement.connect(this,{change:"change"}),new OO.ui.FieldLayout(this.UIelement,{text:this.label,help:this.help,helpInline:this.helpInline,align:"top"})}},{key:"get UIvalue",value:function(){return this.UIelement.getValue()}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),e.type="Dropdown";var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e));return t.values=e.values,t}t.default=a}]);